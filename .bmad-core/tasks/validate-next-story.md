# 验证下一个故事任务(Validate Next Story Task)

## 目的(Purpose)

在实施开始前全面验证故事草稿，确保其完整、准确，并为成功开发提供足够的上下文。此任务识别需要解决的问题和差距，防止幻觉并确保实施就绪。

## 顺序任务执行(SEQUENTIAL Task Execution) (在当前任务完成之前不要继续)

### 0. 加载核心配置和输入(Load Core Configuration and Inputs)

- 加载 `.bmad-core/core-config.yaml`
- 如果文件不存在，停止并通知用户："core-config.yaml 未找到。此文件是故事验证所必需的。"
- 提取关键配置：`devStoryLocation`、`prd.*`、`architecture.*`
- 识别并加载以下输入：
    - **故事文件**：要验证的草拟故事（由用户提供或在 `devStoryLocation` 中发现）
    - **父级史诗**：包含此故事需求的史诗
    - **架构文档**：基于配置（分片或单体）
    - **故事模板**：`bmad-core/templates/story-tmpl.md` 用于完整性验证

### 1. 模板完整性验证(Template Completeness Validation)

- 加载 `bmad-core/templates/story-tmpl.md` 并从模板中提取所有章节标题
- **缺失章节检查**：将故事章节与模板章节进行比较，验证所有必需章节都存在
- **占位符验证**：确保没有模板占位符保持未填充状态（例如，`{{EpicNum}}`、`{{role}}`、`_TBD_`）
- **代理章节验证**：确认模板中的所有章节都存在于未来代理使用
- **结构合规性**：验证故事遵循模板结构和格式

### 2. 文件结构和源树验证(File Structure and Source Tree Validation)

- **文件路径清晰性**：要创建/修改的新/现有文件是否明确指定？
- **源树相关性**：开发笔记中是否包含相关项目结构？
- **目录结构**：新目录/组件是否根据项目结构正确定位？
- **文件创建顺序**：任务是否指定文件应在逻辑顺序中创建的位置？
- **路径准确性**：文件路径是否与架构文档中的项目结构一致？

### 3. UI/前端完整性验证(UI/Frontend Completeness Validation)（如果适用）

- **组件规范**：UI 组件是否足够详细以供实施？
- **样式/设计指导**：视觉实施指导是否清晰？
- **用户交互流程**：是否指定了 UX 模式和行为？
- **响应式/可访问性**：如果需要，是否解决了这些考虑因素？
- **集成点**：前后端集成点是否清晰？

### 4. 验收标准满足度评估(Acceptance Criteria Satisfaction Assessment)

- **AC 覆盖**：列出的任务是否将满足所有验收标准？
- **AC 可测试性**：验收标准是否可测量和可验证？
- **缺失场景**：是否涵盖了边缘情况或错误条件？
- **成功定义**：每个 AC 的"完成"是否明确定义？
- **任务-AC 映射**：任务是否正确链接到特定验收标准？

### 5. 验证和测试指令审查(Validation and Testing Instructions Review)

- **测试方法清晰性**：测试方法是否明确指定？
- **测试场景**：是否识别了关键测试用例？
- **验证步骤**：验收标准验证步骤是否清晰？
- **测试工具/框架**：是否指定了所需的测试工具？
- **测试数据要求**：是否识别了测试数据需求？

### 6. 安全考虑评估(Security Considerations Assessment)（如果适用）

- **安全要求**：是否识别并解决了安全需求？
- **身份验证/授权**：是否指定了访问控制？
- **数据保护**：敏感数据处理要求是否清晰？
- **漏洞预防**：是否解决了常见安全问题？
- **合规要求**：是否解决了监管/合规需求？

### 7. 任务/子任务序列验证(Tasks/Subtasks Sequence Validation)

- **逻辑顺序**：任务是否遵循正确的实施顺序？
- **依赖关系**：任务依赖关系是否清晰且正确？
- **粒度**：任务大小是否适当且可操作？
- **完整性**：任务是否涵盖所有要求和验收标准？
- **阻塞问题**：是否有任何任务会阻塞其他任务？

### 8. 反幻觉验证(Anti-Hallucination Verification)

- **源验证**：每个技术声明必须可追溯到源文档
- **架构对齐**：开发笔记内容与架构规范匹配
- **无虚构细节**：标记任何不受源文档支持的技术决策
- **参考准确性**：验证所有源参考都正确且可访问
- **事实检查**：根据史诗和架构文档交叉引用声明

### 9. 开发代理实施就绪性(Dev Agent Implementation Readiness)

- **自包含上下文**：故事是否可以在不阅读外部文档的情况下实施？
- **清晰指令**：实施步骤是否明确？
- **完整技术上下文**：开发笔记中是否包含所有必需的技术细节？
- **缺失信息**：识别任何关键信息差距
- **可操作性**：所有任务是否可由开发代理操作？

### 10. 生成验证报告(Generate Validation Report)

提供结构化验证报告，包括：

#### 模板合规性问题(Template Compliance Issues)

- 故事模板中缺失的章节
- 未填充的占位符或模板变量
- 结构格式问题

#### 关键问题(Critical Issues)（必须修复 - 故事被阻塞）

- 实施缺少基本信息
- 不准确或不可验证的技术声明
- 不完整的验收标准覆盖
- 缺少必需章节

#### 应该修复的问题(Should-Fix Issues)（重要的质量改进）

- 不清晰的实施指导
- 缺少安全考虑
- 任务排序问题
- 不完整的测试指令

#### 锦上添花的改进(Nice-to-Have Improvements)（可选增强）

- 有助于实施的额外上下文
- 提高效率的澄清
- 文档改进

#### 反幻觉发现(Anti-Hallucination Findings)

- 不可验证的技术声明
- 缺少源参考
- 与架构文档的不一致
- 虚构的库、模式或标准

#### 最终评估(Final Assessment)

- **通过**：故事已准备好实施
- **不通过**：故事在实施前需要修复
- **实施就绪评分**：1-10 分制
- **置信度**：成功实施的高/中/低置信度
